#!/bin/sh
#
########################################################################
# Auto APT Upgrade
#
#  Maintainer: id774 <idnanashi@gmail.com>
#
#  v0.9 2/27,2011
#       Switch aptitude to apt-get.
#  v0.8 9/2,2010
#       Correspond to CentOS.
#  v0.7 8/5,2010
#       Show return code.
#  v0.6 7/27,2009
#       Upgrade clamav.
#  v0.5 11/10,2008
#       Only simulate upgrade in debian unstable.
#  v0.4 6/21,2008
#       Auto Kernel Upgrade.
#  v0.3 9/20,2007
#       Add freshclam.
#  v0.2 9/14,2007
#       Add log header.
########################################################################
JOBLOG=/var/log/auto-upgrade.log

echo -n "*** $0: Job start at `/bin/hostname` on ">>$JOBLOG 2>&1
date "+%Y/%m/%d %T">>$JOBLOG 2>&1

# Debian unstable (simulate only)
#apt-get update >> $JOBLOG 2>&1 && apt-get -s -y full-upgrade >> $JOBLOG 2>&1

# Debian stable/testing
apt-get update >> $JOBLOG 2>&1 && apt-get -y upgrade >> $JOBLOG 2>&1 && apt-get -y install clamav clamav-freshclam >> $JOBLOG 2>&1 && apt-get autoclean >> $JOBLOG 2>&1

# Ubuntu Server
#apt-get update >> $JOBLOG 2>&1 && apt-get -y upgrade >> $JOBLOG 2>&1 && apt-get -y install linux-image-server linux-server gnupg clamav clamav-freshclam >> $JOBLOG 2>&1 && apt-get autoclean >> $JOBLOG 2>&1

# Ubuntu Desktop
#apt-get update >> $JOBLOG 2>&1 && apt-get -y upgrade >> $JOBLOG 2>&1 && apt-get -y install linux-image-generic linux-generic linux-restricted-modules-generic linux-headers linux-headers-generic gnupg clamav clamav-freshclam >> $JOBLOG 2>&1 && apt-get autoclean >> $JOBLOG 2>&1

# CentOS
#yum -y --exclude subversion update >> $JOBLOG 2>&1 && yum clean all >> $JOBLOG 2>&1

# Show return code
echo "Return code is $?">>$JOBLOG 2>&1

# AntiVirus Database
freshclam >> $JOBLOG 2>&1

echo -n "*** $0: End of Job at `/bin/hostname` on ">>$JOBLOG 2>&1
date "+%Y/%m/%d %T">>$JOBLOG 2>&1
echo>>$JOBLOG 2>&1

# ADMIN_MAIL_ADDRESS=xxxxxx@gmail.com
case "$ADMIN_MAIL_ADDRESS" in
  *@*)
    nkf -w $JOBLOG | mail -s "[cron-log][`/bin/hostname`] APT Upgrade Log" $ADMIN_MAIL_ADDRESS
    ;;
esac

